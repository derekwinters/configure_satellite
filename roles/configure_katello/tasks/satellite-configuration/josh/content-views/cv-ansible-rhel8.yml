---

- name: configure content view cv-ansible-rhel8
  theforeman.foreman.katello_content_view:
    username: "{{ satellite.admin_username }}"
    password: "{{ satellite.admin_password }}"
    validate_certs: false
    server_url: "{{ satellite_url }}"
    organization: "{{ organization.organization_name }}"
    name: cv-ansible-rhel8
    repositories:
      - name: Red Hat Ansible Engine 2 for RHEL 8 x86_64 RPMs
        product: Red Hat Ansible Engine
      - name: Red Hat Ansible Engine 2.8 for RHEL 8 x86_64 RPMs
        product: Red Hat Ansible Engine
  register: publish_content_view
  delegate_to: "{{ delegate_host }}"


- name: set current content view name
  set_fact:
    current_content_view: cv-ansible-rhel8
  when:
    - (publish_content_view is defined and publish_content_view.changed) or (content_view_filter is defined and content_view_filter.changed)

- name: publish new version of the content view
  include_tasks: "{{ role_path }}/tasks/publish-content-view.yml"
  vars:
    content_view: "{{ current_content_view }}"
  when:
    - (publish_content_view is defined and publish_content_view.changed) or (content_view_filter is defined and content_view_filter.changed)
